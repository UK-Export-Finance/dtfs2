{% from "govuk/components/tag/macro.njk" import govukTag %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "_macros/fileList.njk" import fileList %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-one-half">
    <h2 class="govuk-heading-l" data-cy="supportingInfo-heading">
      Supporting information
    </h2>
  </div>

  <div class="govuk-grid-column-one-half">
    {{ govukTag({
      text: supportingInfo.status.text,
      classes: 'govuk-!-margin-top-2 govuk-!-margin-bottom-4' + ' ' + supportingInfo.status.class,
      attributes: {
        'data-cy': 'supportingInfo-status'
      }
    }) }}
  </div>
</div>

{% if supportingInfo.status.code === 'NOT_STARTED' and not previewMode %}
  <a class="govuk-link" href="/gef/application-details/{{applicationId}}/supporting-information/manual-inclusion-questionnaire" data-cy="supportingInfo-start-link">Add supporting information</a>
{% else %}
  {% set securityDetailsHtml %}
    {{ govukDetails({
      summaryText: "General security",
      text: supportingInfo.securityDetails.exporter
    }) }}
    {{ govukDetails({
      summaryText: "Specific security for facilities",
      text: supportingInfo.securityDetails.application
    }) }}
  {% endset %}

  {{ govukSummaryList({
    attributes: {
      'data-cy': 'supportingInfo-summary-list'
    },
    rows: [
      {
        key: {
          text: "Manual inclusion questionnaire"
        },
        value: {
          text: "Required" if not supportingInfo.manualInclusion[0],
          classes: "has-text-danger" if not supportingInfo.manualInclusion[0],
          html: fileList(supportingInfo.manualInclusion, "/files/") if supportingInfo.manualInclusion[0]
        },
        actions: {
          items: [
            {
              href: "/gef/application-details/" + applicationId + "/supporting-information/manual-inclusion-questionnaire",
              text: "Change" if supportingInfo.manualInclusion[0] else "Add",
              visuallyHiddenText: "security details"
            }
          ] if not previewMode
        }
      },
      {
        key: {
          text: "Security details"
        },
        value: {
          text: "Required" if not supportingInfo.securityDetails,
          classes: "has-text-danger" if not supportingInfo.securityDetails,
          html: securityDetailsHtml if supportingInfo.securityDetails
        },
        actions: {
          items: [
            {
              href: "/gef/application-details/" + applicationId + "/supporting-information/security-details",
              text: "Change" if supportingInfo.securityDetails else "Add",
              visuallyHiddenText: "security details"
            }
          ] if not previewMode
        }
      }
    ]
  }) }}
{% endif %}

<hr class="govuk-section-break govuk-section-break--bold govuk-section-break--l govuk-section-break--visible">
