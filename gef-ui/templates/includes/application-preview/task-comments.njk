{% from "moj/components/banner/macro.njk" import mojBanner %}

{% if isUkefReviewAvailable or comments.length > 0 %}
  <header data-cy="application-preview-page">

    {% set bannerHtml %}

      {% if renderReviewDecisionLink %}
        <div class="govuk-!-margin-bottom-6" data-cy="ukef-review">
          <a href="/gef/application-details/{{ dealId }}/review-decision" class="govuk-link">Review UKEF decision</a>
        </div>
      {% endif %}

      {% if coverDatesConfirmed %}
        {% if ukefDecision[0].decision == 'Accepted (without conditions)' %}
            <strong>You are proceeding with UKEF cover</strong>
        {% elif ukefDecision[0].decision == 'Accepted (with conditions)' %}
            {% if applicationStatus == "Ready for Checker\'s approval" %}
              <strong>{{ application.maker.firstname }} {{ application.maker.surname }} has accepted the following conditions</strong>
            {% else %}
              <strong>You are proceeding with UKEF cover and accepting the following conditions:</strong>
            {% endif %}
            <p>{{ ukefDecision[0].text | safe }}</p>
        {% endif %}
      {% endif %}

      <div data-cy="latest-comment">
        {% for comment in comments %}
          <strong>Comments from {{ comment.role }} ({{ comment.userName }})</strong>
          <p>{{ comment.createdAt | localiseTimestamp('DD MMM YYYY h:mma', timezone) }}</p>
          <p>{{ comment.comment | safe }}</p>
        {% endfor %}
      </div>

    {% endset %}

    {{ mojBanner({
      type: 'no-icon',
      html: bannerHtml
    }) }}

  </header>
{% endif %}
