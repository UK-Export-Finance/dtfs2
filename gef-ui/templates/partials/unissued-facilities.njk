{% extends "index.njk" %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "moj/components/banner/macro.njk" import mojBanner %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% block pageTitle %}
    Update unissued facilities
{% endblock %}

{% block content %}

    {% if errors %}
        {{
            govukErrorSummary({
            titleText: "There is a problem",
            errorList: errors.errorSummary,
            attributes: {
                'data-cy': 'error-summary'
                }
            })
        }}
    {% endif %}

    {% set hideBack = true %}
    {% include "includes/application-preview/summary.njk" %}

    <div class="govuk-!-margin-bottom-6 govuk-grid-row">
        <div class="govuk-grid-column-full-from-desktop">
            {{ govukBackLink({
                text: "Back",
                href: "/gef/application-details/" + applicationId,
                attributes: {
                'data-cy': 'back-link'
                }
            }) }}
        </div>
    </div>

    {% if facility.length > 0 %}
        {% if success %}
            {{
                mojBanner({
                type: 'success',
                text: success.message,
                iconFallbackText: 'Success'
                })
            }}
        {% endif %}
    {% endif %}


   <div class="govuk-grid-row govuk-body">
      <div class="govuk-grid-column-two-thirds">
            {% if facility.length > 0 %}
               {{ govukTable
                  ({
                        caption: "Update unissued facilities",
                        captionClasses: "govuk-table__caption--xl",
                        firstCellIsHeader: true,
                        classes: "govuk-table__vertical-align",
                        head: [
                           {
                           text: "Facility name"
                           },
                           {
                           text: "UKEF Facility ID"
                           },
                           {
                           text: "Value"
                           },
                           {
                           text: "Deadline for issuing"
                           },
                           {
                           }
                        ],
                        rows: facility
                  })
               }}
               <a href="/gef/application-details/{{ applicationId }}" class="govuk-link">Update facility stage later</a>
            {% else %}
               {{
                  mojBanner({
                  type: 'success',
                  text: 'Facility Stages are now updated',
                  iconFallbackText: 'Success'
                  })
               }}
               <div class="govuk-button-group">
                  {{
                        govukButton({
                        text: "Continue",
                        href: "/gef/application-details/" + applicationId
                        })
                  }}
               </div>
            {% endif %}
      </div>
   </div>


{% endblock %}