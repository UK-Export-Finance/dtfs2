version: "3"
services:
  portal:
    container_name: portal
    build: ./portal
    image: dtfs2/portal
    restart: always
    depends_on:
      - deal-api
    ports:
      - "5000:5000"
    volumes:
      - ./portal/scripts:/app/scripts:ro
      - ./portal/styles:/app/styles:ro
      - ./portal/templates:/app/templates:ro
      - ./portal/server:/app/server:ro
      - ./portal/.env:/app/.env:ro
    command: /bin/bash -c "npm run buildDev && npm install -g nodemon && nodemon --watch dist dist/server.js"

  deal-api:
    container_name: deal-api
    build: ./deal-api
    image: dtfs/deal-api
    restart: always
    depends_on:
      - deal-api-data
    ports:
      - "5001:5000"
    volumes:
      - ./deal-api/src:/app/src:ro
    entrypoint: npx nodemon src/index.js

  deal-api-data:
    container_name: deal-api-data
    image: mongo
    restart: always
    environment:
      - MONGO_INITDB_DATABASE=<todo>
      - MONGO_INITDB_ROOT_USERNAME=<todo>
      - MONGO_INITDB_ROOT_PASSWORD=<todo>
    volumes:
      - ./dealData/init-mongo.js:/docker-entrypoint-initdb.d/init-mongo.js:ro
      - ./dealData_volume:/data/db
    ports:
      - "27017-27019:27017-27019"
networks:
  default:
