name: PR
run-name: 🔎 pull request analysis on ${{ github.event.number }}

on:
  schedule:
    - cron: "00 00 * * *"
env:
  environment: dev
  timezone: ${{ vars.TIMEZONE }}

jobs:
  # 1. Setup test infrastructure
  setup:
    name: Infrastructure setup 🔧
    runs-on: ubuntu-latest
    outputs:
      environment: ${{ env.environment }}
      timezone: ${{ env.timezone }}
    steps:
      - name: Environment 🧪
        run: echo "Environment set to ${{ env.environment }}"

      - name: Timezone 🌐
        run: echo "Timezone set to ${{ env.timezone }}"

  # 2. Identify stale PRs
  stale:
    name: Stale 📅
    needs: setup
    environment:
      name: ${{ needs.setup.outputs.environment }}
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write

    steps:
      - name: Identify
        uses: actions/stale@v5
        with:
          days-before-pr-stale: ${{ vars.STALE_PR_DAYS }}
          stale-pr-message: "Pull request marked as stale due to inactivity."
          stale-pr-label: "Stale"
          days-before-pr-close: ${{ vars.CLOSE_PR_DAYS }}
          close-pr-message: "Pull request has been closed due to inactivity."
          close-pr-label: "Closed"
