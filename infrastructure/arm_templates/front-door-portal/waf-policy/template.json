{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "frontdoorwebapplicationfirewallpolicies_vpn_name": {
            "defaultValue": "vpn",
            "type": "String"
        }
    },
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.Network/frontdoorwebapplicationfirewallpolicies",
            "apiVersion": "2022-05-01",
            "name": "[parameters('frontdoorwebapplicationfirewallpolicies_vpn_name')]",
            "location": "Global",
            "tags": {
                "Environment": "Preproduction"
            },
            "sku": {
                "name": "Classic_AzureFrontDoor"
            },
            "properties": {
                "policySettings": {
                    "enabledState": "Enabled",
                    "mode": "Prevention",
                    "redirectUrl": "https://ukexportfinance.gov.uk/",
                    "customBlockResponseStatusCode": 403,
                    "customBlockResponseBody": "VW5hdGhvcmlzZWQgYWNjZXNz",
                    "requestBodyCheck": "Disabled"
                },
                "customRules": {
                    "rules": [
                        {
                            "name": "[parameters('frontdoorwebapplicationfirewallpolicies_vpn_name')]",
                            "enabledState": "Enabled",
                            "priority": 100,
                            "ruleType": "MatchRule",
                            "rateLimitDurationInMinutes": 1,
                            "rateLimitThreshold": 100,
                            "matchConditions": [
                                {
                                    "matchVariable": "SocketAddr",
                                    "operator": "IPMatch",
                                    "negateCondition": true,
                                    "matchValue": [
                                        "213.86.43.20",
                                        "213.86.43.22",
                                        "51.140.76.208"
                                    ],
                                    "transforms": []
                                }
                            ],
                            "action": "Block"
                        }
                    ]
                },
                "managedRules": {
                    "managedRuleSets": [
                        {
                            "ruleSetType": "DefaultRuleSet",
                            "ruleSetVersion": "1.0",
                            "ruleGroupOverrides": [
                                {
                                    "ruleGroupName": "SQLI",
                                    "rules": [
                                        {
                                            "ruleId": "942200",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942260",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942340",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942180",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942370",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942430",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942480",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942470",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942450",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942440",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942410",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942400",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942390",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942380",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942361",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942360",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942350",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942330",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942320",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942310",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942300",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942290",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942280",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942270",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942250",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942240",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942230",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942220",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942210",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942190",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942170",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942150",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942160",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942140",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942120",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942110",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        },
                                        {
                                            "ruleId": "942100",
                                            "enabledState": "Disabled",
                                            "action": "Block",
                                            "exclusions": []
                                        }
                                    ],
                                    "exclusions": []
                                }
                            ],
                            "exclusions": []
                        }
                    ]
                }
            }
        }
    ]
}