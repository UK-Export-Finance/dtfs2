{% extends "index.njk" %}
{% import '_macros/success-message.njk' as success %}
{% import '_macros/dashboard-tabs.njk' as dashboardTabs %}
{% import '_macros/pagination.njk' as pagination %}
{% import './_macros/deal-filters.njk' as dashboardFilters %}


{% block content %}

  {% if successMessage %}
    {{ success.message(
      message = successMessage
    )}}
  {% endif %}

  <h1 class="govuk-heading-l">Deals</h1>

  <div class="govuk-tabs" data-module="govuk-tabs">
    <h2 class="govuk-tabs__title">Contents</h2>

    {{ dashboardTabs.nav(selected = 'deals', id = id ) }}

    <section class="govuk-tabs__panel">

    {{ dashboardFilters.render(filter, user) }}

      <table class="govuk-table govuk-!-margin-bottom-0">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th scope="col" class="govuk-table__header govuk-!-font-size-14">Bank</th>
            <th scope="col" class="govuk-table__header govuk-!-font-size-14">Supply Contract ID</th>
            <th scope="col" class="govuk-table__header govuk-!-font-size-14">UKEF Deal ID</th>
            <th scope="col" class="govuk-table__header govuk-!-font-size-14">Status</th>
            <th scope="col" class="govuk-table__header govuk-!-font-size-14">Submission type</th>
            <th scope="col" class="govuk-table__header govuk-!-font-size-14">Maker</th>
            <th scope="col" class="govuk-table__header govuk-!-font-size-14">Checker</th>
            <th scope="col" class="govuk-table__header govuk-!-font-size-14">Updated</th>
          </tr>
        </thead>

        <tbody class="govuk-table__body">

          {% for contract in contracts %}
            <tr data-cy="deal_{{contract._id}}" class="govuk-table__row">
              <td data-cy="bank" class="govuk-table__cell govuk-!-font-size-14">
                {{ contract.details.owningBank.name }}
              </td>

              <td data-cy="bankSupplyContractID" class="govuk-table__cell govuk-!-font-size-14">
                <a href="/contract/{{ contract._id }}" class="govuk-link" data-cy="bankSupplyContractIDLink">{{ contract.details.bankSupplyContractID }}</a>
              </td>

              <td data-cy="ukefDealId" class="govuk-table__cell govuk-!-font-size-14">
                {{ contract.details.ukefDealId }}
              </td>

              <td data-cy="status" class="govuk-table__cell govuk-!-font-size-14">
                {{ contract.details.status }}
              </td>

              <td data-cy="submissionType" class="govuk-table__cell govuk-!-font-size-14">
                {{ contract.details.submissionType }}
              </td>

              <td data-cy="maker" class="govuk-table__cell govuk-!-font-size-14">
                {{ contract.details.maker.username }}
              </td>

              <td data-cy="checker" class="govuk-table__cell govuk-!-font-size-14">
                {{ contract.details.checker }}
              </td>

              <td data-cy="updated" class="govuk-table__cell govuk-!-font-size-14">
                {{ contract.details.dateOfLastAction }}
              </td>

            </tr>
          {% endfor %}

        </tbody>

      </table>

      {{ pagination.pagination(totalPages = pages.totalPages, currentPage = pages.currentPage, totalItems = pages.totalItems, paginationRoot = '/dashboard') }}

    </section>

  </div>

{% endblock %}
