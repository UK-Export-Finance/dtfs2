{% extends "index.njk" %}
{% import '_macros/confirm-eligibility-nav.njk' as confirmEligibility %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}

{% block content %}

    {% if validationErrors.count %}
    {{
      govukErrorSummary({
        titleText: "There is a problem",
        errorList: validationErrors.summary
      })
    }}
    {% endif %}

  {{ confirmEligibility.nav(
    completedStatus = eligibility.completedStatus,
    current = 'eligibilityCriteria',
    contractId = _id
  )}}

  <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-8" />
  
  <form method="POST" autocomplete="off">

    {% for criterion in eligibility.criteria %}
      {% set hasValidationError = validationErrors.errorList[criterion.id] %}

      <div id="criterion-group-{{criterion.id}}" class="govuk-form-group {% if hasValidationError %}govuk-form-group--error{% endif %}" data-cy="eligibility-criteria-item">

        <fieldset class="govuk-fieldset">

          <legend class="govuk-fieldset__legend govuk-fieldset__legend">
            Eligibility criterion {{ criterion.id }}
          </legend>

          <p class="govuk-body govuk-hint">{{ criterion.description }}</p>
          {% if hasValidationError %}
          <span class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Eligibility criterion {{ criterion.id }} is required
          </span>
          {% endif %}

          <div class="govuk-radios govuk-radios--inline">

            <div class="govuk-radios__item">
              <input class="govuk-radios__input" id="criterion-{{ criterion.id }}" name="criterion-{{ criterion.id }}" type="radio" value="true" {% if eligibility.status !== "Initial" and criterion.answer %}checked{% endif %} data-cy="criteria-true">
              <label class="govuk-label govuk-radios__label" for="criterion-{{ criterion.id }}">
                True
              </label>
            </div>

            <div class="govuk-radios__item">
              <input class="govuk-radios__input" id="criterion-{{ criterion.id }}-2" name="criterion-{{ criterion.id }}" type="radio" value="false" {% if eligibility.status !== "Initial" and criterion.answer === false %}checked{% endif %} data-cy="criteria-false">
              <label class="govuk-label govuk-radios__label" for="criterion-{{ criterion.id }}-2">
                False
              </label>
            </div>
          </div>

        </fieldset>

      </div>

    {% endfor %}

    <input type="submit" class="govuk-button govuk-!-margin-right-1" data-module="govuk-button" value="Next page" data-cy="next-page" />

    <input
      type="submit"
      formaction="/contract/{{ _id }}/eligibility/criteria/save-go-back"
      class="govuk-button govuk-button--secondary"
      data-module="govuk-button"
      value="Save and go back to deal"
    />
    
  </form>

{% endblock %}
