{% extends "index.njk" %}
{% import '_macros/mandatory-criteria-box.njk' as mandatoryCriteriaBox %}
{% import '_macros/eligibility-criteria-answers.njk' as eligibilityCriteriaAnswers %}
{% import '_macros/eligibility-documentation-preview.njk' as eligibilityDocumentation %}
{% import 'contract/about/components/submission-details.njk' as submissionDetails %}
{% import 'bond/_macros/bond-submission-details.njk' as bondSubmissionDetails %}
{% import 'loan/_macros/loan-submission-details.njk' as loanSubmissionDetails %}

{% import './components/contract-overview-table.njk' as contractOverviewTable %}
{% import './components/contract-tabs.njk' as contractTabs %}

{% block pageTitle %}Preview - {{ deal.details.bankSupplyContractName }}{% endblock %}

{% block content %}
  {% set componentData = {user: user, deal: deal, editable: editable, dealFormsCompleted: dealFormsCompleted, selected: 'submission-details'} %}

  <h1 data-cy="heading" class="govuk-heading-l">Supply Contract name: <span class="govuk-body govuk-!-font-size-24">{{ deal.details.bankSupplyContractName }}</span></h1>

  <div class="govuk-tabs" data-module="govuk-tabs">
    <h2 class="govuk-tabs__title">
      Contents
    </h2>

    {{ contractTabs.render(componentData) }}

    <section class="govuk-tabs__panel" id="submission-details">
      {{ contractOverviewTable.render(componentData) }}

      <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-8">

      <h2 class="govuk-heading-l">
        General deal information
        <a class="govuk-link govuk-!-font-size-16 govuk-!-font-weight-regular" href="/contract/{{ deal._id}}/about/supplier">edit</a>
      </h2>

      {{ submissionDetails.general(deal.submissionDetails) }}

      <h3 class="govuk-heading-l">
        Confirm eligibility
        <a class="govuk-link govuk-!-font-size-16 govuk-!-font-weight-regular" href="/contract/{{ deal._id}}/eligibility/criteria">edit</a>
      </h3>

      {{ mandatoryCriteriaBox.success(mandatoryCriteria)}}

      {{ eligibilityCriteriaAnswers.render(deal.eligibility.criteria)}}

      {{ eligibilityDocumentation.render(deal.dealFiles, deal._id)}}

      {% for bond in deal.bondTransactions.items %}
        <h3 class="govuk-heading-l">
          Bond
          <a class="govuk-link govuk-!-font-size-16 govuk-!-font-weight-regular" href="/contract/{{ deal._id }}/bond/{{ bond._id }}/details">edit</a>
        </h3>

        {{ bondSubmissionDetails.render(bondDetails = bond)}}
      {% endfor %}

      {% for loan in deal.loanTransactions.items %}
        <h3 class="govuk-heading-l">
          Loan
          <a class="govuk-link govuk-!-font-size-16 govuk-!-font-weight-regular" href="/contract/{{ deal._id }}/loan/{{ loan._id }}/guarantee-details">edit</a>
        </h3>

        {{ loanSubmissionDetails.render(loanDetails = loan)}}
      {% endfor %}

      <p class="govuk-body"><a href="/contract/{{ deal._id }}" class="govuk-link">Back to Supply Contract page</a></p>

    </section>

  </div>

{% endblock %}
