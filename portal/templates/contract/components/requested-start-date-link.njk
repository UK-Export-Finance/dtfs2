{% macro render(params) %}

  {% set userIsMaker = params.user.roles.includes('maker')%}
  {% set userIsChecker = params.user.roles.includes('checker')%}

  {% set dealId = params.deal._id %}
  {% set dealStatus = params.deal.details.status %}
  {% set dealSubmissionType = params.deal.details.submissionType %}
  {% set dealPreviousStatus = params.deal.details.previousStatus %}

  {% set facility = params.facility %}
  {% set facilityName = params.facilityName %}

  {% set requestedCoverDateCanEdit = userIsMaker and dealSubmissionType === 'Manual Inclusion Application' and (facility.facilityStage === 'Unconditional' or facility.bondStage === 'Issued') %}

  {% if requestedCoverDateCanEdit %}
      <a href="/contract/{{ dealId }}/{{ facilityName }}/{{ facility._id}}/confirm-requested-cover-start-date" class="govuk-link" data-cy="{{ facilityName }}-change-or-confirm-cover-start-date-{{ facility._id }}">
       {% if params.hasConfirmedCoverStartDate %} 
          Start date changed
       {% else %}
          Confirm start date
       {% endif %}
      </a>
  {% endif %}

{% endmacro %}
