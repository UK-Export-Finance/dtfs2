{% macro render(params) %}
  {% set legendText = params.legendText %}
  {% set paymentGroups = params.paymentGroups %}
  {% set errorMessage = params.errorMessage %}

  {% if errorMessage %}
    <div class="govuk-form-group--error" data-cy="fee-record-details-error-wrapper">
  {% endif %}
  <div class="govuk-form-group" id="paymentGroup" data-cy="payment-group-radio-input">
    <fieldset class="govuk-fieldset">
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--l govuk-!-margin-bottom-0">
        <h2 class="govuk-fieldset__legend--m  govuk-!-margin-top-0" data-cy="payment-group-radio-input-heading">
          {{ legendText }}
        </h2>
      </legend>
      {% if errorMessage %}
        <p class="govuk-error-message">
          <span class="govuk-visually-hidden">Error: </span>{{ errorMessage}}
        </p>
      {% endif %}
      {# TODO FN-1749: Do not render radio input if there is only one payment group available. See ACs. Hidden input in this case? #}
      <div class="govuk-radios" data-module="govuk-radios">
        {% for paymentGroup in paymentGroups %}
          <div class="govuk-radios__item" data-cy="payment-group--{{ paymentGroup.radioId }}">
            <input class="govuk-radios__input" id="{{ paymentGroup.radioId }}" name="paymentGroup" type="radio" value="{{ paymentGroup.radioId }}">
            <label class="govuk-label govuk-radios__label" for="{{ paymentGroup.radioId }}">
              {% for payment in paymentGroup.payments %}
                <div class="govuk-label {{ 'govuk-!-margin-bottom-2' if not payment.reference }}" id="payment-{{ payment.id }}-currency-and-amount">
                  {{ payment.formattedCurrencyAndAmount }}
                </div>
                {% if payment.reference %}
                  <div class="govuk-hint" id="payment-{{ payment.id }}-item-hint">
                    Payment reference: {{ payment.reference }}
                  </div>
                {% endif %}
              {% endfor %}
            </label>
          </div>
        {% endfor %}
      </div>
    </fieldset>
  </div>
  {% if errorMessage %}
    </div>
  {% endif %}
{% endmacro %}