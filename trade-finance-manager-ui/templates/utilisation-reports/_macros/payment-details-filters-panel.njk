{% from 'moj/components/filter/macro.njk' import mojFilter %}
{% import './payment-details-filters-form.njk' as paymentDetailsFiltersForm %}

{# TODO FN-2311: Add component tests for this macro. #}

{% macro render(params) %}
  {% set filters = params.filters %}
  {% set selectedFilters = params.selectedFilters %}
  {% set paymentReference = params.paymentReference %}
  {% set facilityId = params.facilityId %}

  {% set filterOptionsHtml %}
    {{ paymentDetailsFiltersForm.render({
      filters: filters,
      paymentReference: paymentReference,
      facilityId: facilityId
    }) }}
  {% endset %}

  <div class="moj-filter-layout__filter">

    <form method="GET" data-cy="payment-details-filter-form">

      {% if selectedFilters.length %}

        {# TODO FN-2311: Change clearLink.href to link to the page without any filters passed as query params. #}
        {{ mojFilter({
          heading: {
            text: 'Filter'
          },
          selectedFilters: {
            heading: {
              text: 'Selected filters'
            },
            clearLink: {
              text: 'Clear filters',
              href: 'clear-all-filters'
            },
            categories: selectedFilters
          },
          attributes: {
            'data-cy': 'payment-details-filters-container'
          },
          optionsHtml: filterOptionsHtml
        }) }}

      {% else %}

        {{ mojFilter({
          heading: {
            text: 'Filter'
          },
          attributes: {
            'data-cy': 'payment-details-filters-container'
          },
          optionsHtml: filterOptionsHtml
        }) }}

      {% endif %}

    </form>

  </div>
{% endmacro %}
