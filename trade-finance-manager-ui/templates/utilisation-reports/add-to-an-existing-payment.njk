{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% import "./_macros/fee-record-details-table.njk" as feeRecordDetailsTable %}
{% import "./_macros/payment-group-radio-input-group.njk" as paymentGroupRadioInputGroup %}
{% extends "index.njk" %}
{% set backLink = {"href": '/utilisation-reports/' + reportId} %}
{% block pageTitle %}
  {% if errors.errorSummary | length %}Error - {% endif %}
  Add to an existing payment
{% endblock %}
{% block content %}
  {% if errors.errorSummary | length %}
    {{ govukErrorSummary({
        titleText: "There is a problem",
        errorList: errors.errorSummary,
        attributes: {
        'data-cy': 'error-summary'
        }
    }) }}
  {% endif %}

  {% set pageHeading = "Add reported fee" + ("s" if reportedFeeDetails.feeRecords | length > 1 else "") + " to an existing payment" %}

  <div class="govuk-grid-row govuk-!-padding-top-7">
    <div class="govuk-grid-column-full">
      <span class="govuk-caption-l"  data-cy="add-to-an-existing-payment-heading-caption">{{ bank.name }},
      {{ formattedReportPeriod }}</span>
      <h1 class="govuk-heading-l">{{ pageHeading }}</h1>
    </div>
  </div>

  {{ feeRecordDetailsTable.render({
    captionText: "Selected reported fees details",
    feeRecords: reportedFeeDetails.feeRecords,
    totalReportedPayments: reportedFeeDetails.totalReportedPayments,
    enableSelectingFeeRecords: false,
    overrides: {
      reportedFeesHeader: 'Reported fee'
    }
  }) }}

  <form method="post">
    <input type="hidden" name="_csrf" value="{{ csrfToken }}"/>
    <input type="hidden" name="addToAnExistingPaymentFormSubmission" value="true"/>
    {% for id in selectedFeeRecordCheckboxIds %}<input type="hidden" name={{ id }} value="on"/>{% endfor %}

    {{ paymentGroupRadioInputGroup.render({
      legendText: availablePaymentsHeading,
      paymentGroups: availablePaymentGroups,
      errorMessage: errors.paymentGroupErrorMessage
    }) }}

    <div class="govuk-button-group">
      {{ govukButton({
        "text": "Continue",
        attributes: {
          "data-cy": "continue-button"
        }
      }) }}
      {# TODO FN-3293: Add 'Cancel' link and associated redirect logic to include selected fee record IDs. #}
    </div>
  </form>
{% endblock %}
{% block sub_content %}{% endblock %}