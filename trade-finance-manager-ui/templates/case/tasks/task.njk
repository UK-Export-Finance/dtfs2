{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{# TODO: should not  have case summary #}
{% extends "case/case.njk" %}

{% block sub_content %}

  <p>Task</p>
  <h2 class="header-label" data-cy="task-heading">{{ task.title }}</h2>

  <div class="govuk-grid-row" data-cy="deal-tasks">

    <h4 data-cy="deal-heading">Deal</h4>
    <p data-cy="deal-subheading"><a href="/case/{{ dealId }}/deal" data-cy="deal-subheading-link">{{ deal.details.ukefDealId }}</a>&nbsp;{{ deal.submissionDetails.supplierName }} &#62; {{ deal.submissionDetails.buyerName }}</p>

    <h4 data-cy="type-of-work-heading">Type of work</h4>
    <p data-cy="type-of-work-subheading">{{ deal.details.submissionType }} </p>

    <h4 data-cy="team-heading">Team</h4>
    <p data-cy="team-subheading">{{ task.team.name }}</p>

    <form method="POST" autocomplete="off">

      {% set assignToMeCopy = (userFullName + ' ' + '(Assign to me)') %}

      {% if taskIsAssignedToUser %}
        {% set assignToMeCopy = userFullName %}
      {% endif %}

      {{ govukSelect({
        id: "assignedTo",
        name: "assignedTo",
        label: {
          text: "Assigned to"
        },
        attributes: {
          'data-cy': 'assigned-to-select-input'
        },
        items: [
          {
            value: "Unassigned",
            text: "Unassigned",
            selected: task.assignedTo === 'Unassigned',
            attributes: {
              'data-cy': 'assigned-to-select-input-option'
            }
          },
          {
            value: user._id,
            text: assignToMeCopy,
            selected: taskIsAssignedToUser,
            attributes: {
              'data-cy': 'assigned-to-select-input-option'
            }
          }
        ]
      }) }}

      {{govukRadios({
          fieldset: {
            legend: {
              text: "Status",
              classes: "govuk-fieldset__legend--m"
            }
          },
          attributes: {
            'data-cy': 'task-status-radios'
          },
          name: "status",
          items: [
            {
              value: "To do",
              text: "To do",
              checked: task.status === 'To do',
              attributes: {
                'data-cy': 'task-status-to-do'
              }
            },
            {
              value: "In progress",
              text: "In progress",
              checked: task.status === 'In progress',
              attributes: {
                'data-cy': 'task-status-in-progress'
              }
            },
            {
              value: "Done",
              text: "Done",
              checked: task.status === 'Done',
              attributes: {
                'data-cy': 'task-status-done'
              }
            }
          ]
        })
      }}

      {{ govukButton({
        text: "Save and close",
        attributes: {
          'data-cy': 'submit-button'
        }
      }) }}

      <a class="govuk-link govuk-!-margin-left-6 close-without-saving-link" href="/case/{{ dealId }}/tasks" data-cy="close-link">Close without saving</a>
     
    </form>

  </div>
{% endblock %}
