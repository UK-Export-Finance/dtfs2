{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{# TODO: should not  have case summary #}
{% extends "case/case.njk" %}

{% block sub_content %}

  <p>Task</p>
  <h2 class="header-label" data-cy="task-heading">{{ task.title }}</h2>
  
  <div class="govuk-grid-row" data-cy="deal-tasks">

    <h4 data-cy="deal-heading">Deal</h4>
    <p data-cy="deal-subheading"><a href="/case/{{ dealId }}/deal" data-cy="deal-subheading-link">{{ deal.details.ukefDealId }}</a>&nbsp;{{ deal.submissionDetails.supplierName }} &#62; {{ deal.submissionDetails.buyerName }}</p>

    <h4 data-cy="type-of-work-heading">Type of work</h4>
    <p data-cy="type-of-work-subheading">{{ deal.details.submissionType }} </p>

    <h4 data-cy="team-heading">Team</h4>
    <p data-cy="team-subheading">{{ task.team.name }}</p>

    <form>
      {% set currentUser = (user.firstName + ' ' + user.lastName + ' ' + '(Assign to me)') %}
   
      {{ govukSelect({
        id: "sort",
        name: "sort",
        label: {
          text: "Assigned to"
        },
        items: [
          {
            value: "Unassigned",
            text: "Unassigned"
          },
          {
            value: user._id,
            text: currentUser
          }
        ],
        attributes: {
          'data-cy': 'assigned-to-select-input'
        }
      }) }}

      {{govukRadios({
          fieldset: {
            legend: {
              text: "Status",
              classes: "govuk-fieldset__legend--m"
            }
          },
          name: "status",
          items: [
            {
              value: "To do",
              text: "To do",
              attributes: {
                'data-cy': 'task-status-to-do'
              }
            },
            {
              value: "In progress",
              text: "In progress",
              attributes: {
                'data-cy': 'task-status-in-progress'
              }
            },
            {
              value: "Done",
              text: "Done",
              attributes: {
                'data-cy': 'task-status-done'
              }
            }
          ]
        })
      }}

      {{ govukButton({
        text: "Save and close",
        attributes: {
          'data-cy': 'save-button'
        }
      }) }}

      <a class="govuk-link govuk-!-margin-left-6 close-without-saving-link" href="/case/{{ dealId }}/tasks" data-cy="close-link">Close without saving</a>
     
    </form>

  </div>
{% endblock %}
