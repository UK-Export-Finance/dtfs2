{% import './_macros/parties-key-value-array-grid-row.njk' as keyValueArrayGridRow %}
{% import './_macros/parties-exporter-area.njk' as exporterArea %}
{% import './_macros/parties-buyer-area.njk' as buyerArea %}
{% import './_macros/parties-agent-area.njk' as agentArea %}
{% import './_macros/parties-indemnifier-area.njk' as indemnifierArea %}
{% import './_macros/parties-bond-issuer-area.njk' as bondIssuerArea %}
{% import './_macros/parties-bond-beneficiary-area.njk' as bondBeneficiaryArea %}
{% from "moj/components/banner/macro.njk" import mojBanner %}

{% extends "case/case.njk" %}
{%- from "govuk/components/tag/macro.njk" import govukTag -%}

{% block sub_content %}
  {% if hasAmendmentInProgress === true %}
    {% set bannerHtml %}
      <p class="govuk-body" data-cy="amendment--in-progress-bar">Amendment in progress for
      {% for amendment in amendmentsInProgress %}
        <a href="/case/{{dealId}}/facility/{{amendment.facilityId}}#amendments" data-cy="amendment--in-progress-bar-link"> facility {{amendment.ukefFacilityId}} </a>
        {% if loop.index < amendmentsInProgress.length %}
          ,
        {% endif %}
      {% endfor %}
      </p>
    {% endset %}

    {{ mojBanner({
      type: 'information',
      classes: 'govuk-!-margin-bottom-0 govuk-!-margin-top-6',
      html: bannerHtml
    }) }}
  {% endif %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-three-quarters">
      <p class="header-label" aria-label="Parties" data-cy="parties-heading">Parties</p>
    </div>
  </div>

  <section class="deal-parties-section">
    {{ exporterArea.render({
      deal: deal,
      tfm: tfm,
      userCanEdit: userCanEdit,
      renderEditLink: renderEditLink
    }) }}
  </section>

  <section class="deal-parties-section">
    {{ buyerArea.render({
      deal: deal,
      tfm: tfm,
      userCanEdit: userCanEdit,
      renderEditLink: renderEditLink
    }) }}
  </section>

  <section class="deal-parties-section">
    {{ agentArea.render({
      deal: deal,
      tfm: tfm,
      userCanEdit: userCanEdit,
      renderEditLink: renderEditLink,
      renderEditForm: renderEditForm
    }) }}
  </section>

  <section class="deal-parties-section">
    {{ indemnifierArea.render({
      deal: deal,
      tfm: tfm,
      userCanEdit: userCanEdit,
      renderEditLink: renderEditLink
    }) }}
  </section>

  <section class="deal-parties-section">
    {{ bondIssuerArea.render({
      deal: deal,
      tfm: tfm,
      userCanEdit: userCanEdit,
      renderEditLink: renderEditLink
    }) }}
  </section>

  <section class="deal-parties-section">
    {{ bondBeneficiaryArea.render({
      deal: deal,
      tfm: tfm,
      userCanEdit: userCanEdit,
      renderEditLink: renderEditLink
    }) }}
  </section>

{% endblock %}
