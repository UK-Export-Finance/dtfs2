{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% import './_macros/managers-decision-submitted.njk' as managersDecisionSubmitted %}

{% macro render(params) %}
  {% set underwriterManagerDecision = params.underwriterManagerDecision %}
  {% set amendment = params.amendment %}
  {% set decision = underwriterManagerDecision.underwriterManagersDecision.decision %}
  {% set user = underwriterManagerDecision.underwriterManagersDecision.user %}
  {% set dealId = amendment.dealId %}
  {% set facilityId = amendment.facilityId %}
  {% set amendmentId = amendment.amendmentId %}

  {% block underwriting_content %}
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-three-quarters">
        {% if decision %}
          {% set managersDecisionSubmittedComponentData = {
            decision: decision,
            user: user
          } %}
          {{ managersDecisionSubmitted.render(managersDecisionSubmittedComponentData) }}
        {% else %}
          {% if underwriterManagerDecision.isEditable %}
            {% if amendment.changeCoverEndDate %}
              <div class="govuk-!-padding-top-0">
                {{ govukButton({
                    text: "Add decision",
                    href: "/case/" + dealId + "/facility/" + facilityId + "/amendment/" + amendmentId + "/cover-end-date/managers-decision",
                    attributes: { "data-cy":"amendment-manager-add-decision-link" }
                  }) }}
              </div>
            {% elif amendment.changeFacilityValue %}
              <div class="govuk-!-padding-top-0">
                {{ govukButton({
                    text: "Add decision",
                    href: "/case/" + dealId + "/facility/" + facilityId + "/amendment/" + amendmentId + "/facility-value/managers-decision",
                    attributes: { "data-cy":"amendment-manager-add-decision-link" }
                  }) }}
              </div>
            {% endif %}
          {% else %}
            <p class="govuk-!-margin-top-0" data-cy="amendment-manager-decision-not-added-readonly">Not added yet</p>
          {% endif %}
        {% endif %}
      </div>
    </div>
  {% endblock %}
{% endmacro %}